<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaEdition AI | Direct Gemini Integration</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@google/genai@0.16.0/dist/client.umd.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --light: #ffffff;
            --dark: #0f172a;
            --sidebar-bg: #f8fafc;
            --chat-bg: #ffffff;
            --user-msg: #f1f5f9;
            --ai-msg: #ffffff;
            --input-bg: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --transition: all 0.2s ease;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: var(--light);
            box-shadow: var(--shadow);
            border-radius: 12px;
            overflow: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: var(--light);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            background: var(--primary);
            border: none;
            border-radius: var(--radius);
            color: var(--light);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
        }

        .new-chat-btn:hover {
            background: var(--primary-dark);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .chat-item {
            padding: 12px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .chat-item:hover {
            background: var(--light);
            border-color: var(--border);
        }

        .chat-item.active {
            background: var(--light);
            border-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: var(--light);
        }

        /* Main Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--chat-bg);
        }

        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .model-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .model-badge {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
            background: var(--chat-bg);
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 24px;
            color: var(--primary);
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--dark);
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--secondary);
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.6;
        }

        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            max-width: 800px;
            margin-bottom: 40px;
        }

        .capability-card {
            padding: 20px;
            background: var(--light);
            border-radius: var(--radius);
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .capability-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .capability-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .capability-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .capability-desc {
            font-size: 14px;
            color: var(--secondary);
            line-height: 1.5;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: var(--chat-bg);
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 100%;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--primary);
            color: white;
        }

        .message.ai .message-avatar {
            background: #10b981;
            color: white;
        }

        .message-content {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--radius);
            line-height: 1.6;
            font-size: 14px;
        }

        .message.user .message-content {
            background: var(--primary);
            color: white;
        }

        .message.ai .message-content {
            background: var(--light);
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .chat-input-container {
            padding: 20px;
            background: var(--light);
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .chat-input {
            width: 100%;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 50px 12px 16px;
            color: var(--dark);
            font-size: 14px;
            resize: none;
            min-height: 48px;
            max-height: 120px;
            line-height: 1.5;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .send-btn {
            position: absolute;
            right: 8px;
            bottom: 8px;
            background: var(--primary);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-footer {
            text-align: center;
            margin-top: 12px;
            font-size: 12px;
            color: var(--secondary);
        }

        .ai-generated-badge {
            text-align: center;
            font-size: 11px;
            color: var(--secondary);
            margin-top: 8px;
            font-style: italic;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--light);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            font-size: 14px;
            color: var(--secondary);
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--secondary);
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: -280px;
                z-index: 1000;
                height: 100%;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .capabilities-grid {
                grid-template-columns: 1fr;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--sidebar-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">N</div>
                    <div class="logo-text">NovaEdition AI</div>
                </div>
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i>
                    New chat
                </button>
            </div>
            
            <div class="chat-history" id="chatHistory">
                <div class="chat-item active">
                    <i class="fas fa-message"></i>
                    <span>Welcome Chat</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius); background: var(--sidebar-bg);">
                    <div style="width: 36px; height: 36px; border-radius: 8px; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600;">User</div>
                        <div style="font-size: 12px; color: var(--secondary);">Online</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <div class="model-info">
                    <div class="model-badge">
                        <i class="fas fa-robot"></i> NovaEdition AI (Powered by Gemini)
                    </div>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1 class="welcome-title">Welcome to NovaEdition AI</h1>
                    <p class="welcome-subtitle">
                        Your premium AI assistant powered by **Gemini**. I can help you with creative writing, 
                        coding, problem solving, and much more in multiple languages.
                    </p>
                    
                    <div class="capabilities-grid">
                        <div class="capability-card" onclick="askQuickQuestion('Help me write a creative story')">
                            <div class="capability-icon">
                                <i class="fas fa-feather"></i>
                            </div>
                            <div class="capability-title">Creative Writing</div>
                            <div class="capability-desc">Stories, poems, content in multiple languages</div>
                        </div>
                        
                        <div class="capability-card" onclick="askQuickQuestion('Write Python code to sort a list')">
                            <div class="capability-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="capability-title">Code Generation</div>
                            <div class="capability-desc">Programming in Python, JavaScript, Java, etc.</div>
                        </div>
                        
                        <div class="capability-card" onclick="askQuickQuestion('Explain quantum computing simply')">
                            <div class="capability-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="capability-title">Explain Concepts</div>
                            <div class="capability-desc">Complex topics in simple language</div>
                        </div>
                        
                        <div class="capability-card" onclick="askQuickQuestion('Help me plan a project')">
                            <div class="capability-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="capability-title">Problem Solving</div>
                            <div class="capability-desc">Brainstorm ideas and find solutions</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Message NovaEdition..." 
                        rows="1"
                    ></textarea>
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="input-footer">
                    ⚠️ **INSECURE:** API Key is directly in the file. Use only for local testing. Powered by Google Gemini.
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements (Same as before)
        const elements = {
            messagesContainer: document.getElementById('messagesContainer'),
            chatInput: document.getElementById('chatInput'),
            sendBtn: document.getElementById('sendBtn'),
            welcomeScreen: document.getElementById('welcomeScreen'),
            newChatBtn: document.getElementById('newChatBtn'),
            chatHistory: document.getElementById('chatHistory')
        };

        let currentChat = null;
        let chats = JSON.parse(localStorage.getItem('novaEditionChats')) || [];
        let isGenerating = false;
        
        // --- 2. GEMINI CLIENT SETUP (INSECURE) ---
        // ⚠️ WARNING: API Key is exposed here. Use only for local testing.
        const GEMINI_API_KEY = 'AIzaSyBlPNFOrM3pJDhy1E5yeciNZeJSa9U8s3Y'; 
        const MODEL_NAME = 'gemini-2.5-flash';

        // Initialize the Gemini Client
        const ai = new GoogleGenAI.GoogleGenAI(GEMINI_API_KEY);
        let chatSession = null; // To hold the ongoing chat session for context

        // System Instruction (AI ki personality)
        const SYSTEM_INSTRUCTION = `You are NovaEdition AI, a helpful, premium AI assistant powered by Gemini. 
        Your responses should be engaging, informative, and formatted using Markdown. 
        You must maintain the context of the conversation. 
        Always be ready to answer in Hindi, English, or Hinglish. Be creative and concise.`;


        // Initialize App (Same as before)
        function initApp() {
            setupEventListeners();
            loadChatHistory();
            
            if (chats.length > 0) {
                // If chats exist, load the last one
                loadChat(chats[chats.length - 1].id);
            } else {
                // Otherwise, show welcome screen and initialize a new session
                elements.welcomeScreen.style.display = 'flex';
                initializeNewChatSession();
            }
        }
        
        // --- 3. NEW: Initialize Gemini Chat Session ---
        function initializeNewChatSession(history = []) {
            chatSession = ai.chats.create({
                model: MODEL_NAME,
                config: {
                    systemInstruction: SYSTEM_INSTRUCTION,
                },
                history: history.map(msg => ({ // Map stored messages to Gemini format
                    role: msg.role === 'assistant' ? 'model' : 'user',
                    parts: [{ text: msg.content }]
                }))
            });
        }

        // Setup Event Listeners (Same as before)
        function setupEventListeners() {
            elements.sendBtn.addEventListener('click', sendMessage);
            
            elements.chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            elements.chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            elements.newChatBtn.addEventListener('click', createNewChat);
        }

        // Create New Chat (Modified to initialize session)
        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            const newChat = {
                id: chatId,
                title: 'New Chat',
                messages: [],
                createdAt: new Date().toISOString()
            };
            
            chats.push(newChat);
            saveChats();
            loadChat(chatId);
            elements.welcomeScreen.style.display = 'none';
            initializeNewChatSession(); // Start a fresh Gemini session
        }

        // Load Chat History (Same as before)
        function loadChatHistory() {
            elements.chatHistory.innerHTML = '';
            
            // Reverse order to show latest chat first in history panel
            [...chats].reverse().forEach(chat => {
                const chatElement = document.createElement('div');
                const isActive = currentChat === chat.id;
                chatElement.className = `chat-item ${isActive ? 'active' : ''}`;
                chatElement.innerHTML = `
                    <i class="fas fa-message"></i>
                    <span>${chat.title}</span>
                `;
                
                chatElement.addEventListener('click', () => loadChat(chat.id));
                elements.chatHistory.appendChild(chatElement);
            });
        }

        // Load Specific Chat (Modified to initialize session with history)
        function loadChat(chatId) {
            currentChat = chatId;
            const chat = chats.find(c => c.id === chatId);
            
            if (!chat) return;
            
            elements.messagesContainer.innerHTML = '';
            elements.welcomeScreen.style.display = 'none';
            
            chat.messages.forEach(msg => {
                addMessageToUI(msg.role, msg.content, false);
            });
            
            loadChatHistory();
            scrollToBottom();
            initializeNewChatSession(chat.messages); // Load history into the Gemini session
        }

        // Send Message (Modified for Direct API Call)
        async function sendMessage() {
            const message = elements.chatInput.value.trim();
            if (!message || isGenerating) return;

            // Ensure chat session and chat ID exist
            if (!currentChat) {
                createNewChat();
            }

            // Add user message
            addMessageToUI('user', message);
            elements.chatInput.value = '';
            elements.chatInput.style.height = 'auto';
            
            // Save user message to chat (before getting AI response)
            saveMessage('user', message);
            
            // Update chat title if first message
            updateChatTitle(message);

            // Show typing indicator
            const typingIndicator = showTypingIndicator();
            
            isGenerating = true;
            elements.sendBtn.disabled = true;

            try {
                // --- *** DIRECT API CALL TO GEMINI *** ---
                const response = await chatSession.sendMessage({ message: message });
                
                // Remove typing indicator
                typingIndicator.remove();
                
                const aiResponse = response.text;
                
                // Add AI response
                addMessageToUI('assistant', aiResponse);
                saveMessage('assistant', aiResponse);
                
            } catch (error) {
                console.error('Gemini API Error:', error);
                typingIndicator.remove();
                addMessageToUI('assistant', 
                    `**Gemini Connection Error!** ❌\n\nThere was an issue communicating with the Gemini API. This might be due to:\n1. An invalid or expired API Key.\n2. Network issues.\n3. Content that violated safety policies.\n\nPlease check your console for details. (Error: ${error.message})`
                );
            } finally {
                isGenerating = false;
                elements.sendBtn.disabled = false;
            }
        }

        // Add Message to UI, Format Message Content, Show Typing Indicator, Save Message, 
        // Update Chat Title, Save Chats, Scroll to Bottom, Quick Question Feature 
        // (All these auxiliary functions remain the same as the complete code)

        function addMessageToUI(role, content, scroll = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const avatar = role === 'user' ? 
                '<div class="message-avatar"><i class="fas fa-user"></i></div>' :
                '<div class="message-avatar"><i class="fas fa-robot"></i></div>';
            
            const formattedContent = formatMessage(content);
            
            messageDiv.innerHTML = `
                ${avatar}
                <div class="message-content">${formattedContent}</div>
            `;
            
            elements.messagesContainer.appendChild(messageDiv);
            
            // Change AI generated badge text
            if (role === 'assistant') {
                const badge = document.createElement('div');
                badge.className = 'ai-generated-badge';
                badge.textContent = 'Powered by Google Gemini. Content may contain errors.';
                elements.messagesContainer.appendChild(badge);
            }
            
            if (scroll) {
                scrollToBottom();
            }
            
            return messageDiv;
        }

        function formatMessage(content) {
            // Handle code blocks
            let formatted = content.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                return `<div style="background: #1e293b; color: white; padding: 12px; border-radius: 6px; margin: 8px 0; font-family: monospace; font-size: 12px; white-space: pre-wrap; border: 1px solid #334155;">${code.trim()}</div>`;
            });
            
            // Handle bold text
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Handle line breaks
            formatted = formatted.replace(/\n/g, '<br>');
            
            return formatted;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.innerHTML = `
                <div class="message-avatar"><i class="fas fa-robot"></i></div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span>NovaEdition AI is typing</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            elements.messagesContainer.appendChild(typingDiv);
            scrollToBottom();
            return typingDiv;
        }

        function saveMessage(role, content) {
            const chat = chats.find(c => c.id === currentChat);
            if (chat) {
                chat.messages.push({ role, content, timestamp: new Date().toISOString() });
                saveChats();
            }
        }

        function updateChatTitle(firstMessage) {
            const chat = chats.find(c => c.id === currentChat);
            if (chat && chat.title === 'New Chat') {
                chat.title = firstMessage.substring(0, 30) + (firstMessage.length > 30 ? '...' : '');
                saveChats();
                loadChatHistory();
            }
        }

        function saveChats() {
            localStorage.setItem('novaEditionChats', JSON.stringify(chats));
        }

        function scrollToBottom() {
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
        }

        function askQuickQuestion(question) {
            elements.chatInput.value = question;
            elements.welcomeScreen.style.display = 'none';
            sendMessage();
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
