<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile | AI Prompt Gallery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <style>
        /* Profile Page CSS - Same as before */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI'; }
        :root { 
            --primary: #2563eb; --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --owner-bg: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            --member-bg: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
        }
        body { background: #f8fafc; color: #1e293b; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: var(--gradient); color: white; padding: 40px 30px; border-radius: 16px; margin-bottom: 30px; text-align: center; position: relative; }
        .back-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 8px 16px; border-radius: 20px; text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .theme-toggle { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; padding: 10px; border-radius: 50%; cursor: pointer; color: white; }
        .profile-container { background: white; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 30px; }
        .profile-header { background: var(--gradient); padding: 40px 30px; color: white; position: relative; }
        .profile-content { display: flex; align-items: center; gap: 30px; }
        .profile-avatar { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid white; }
        .edit-avatar-btn { position: absolute; bottom: 5px; right: 5px; background: #2563eb; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; }
        .profile-name { font-size: 2rem; font-weight: 700; margin: 0; }
        .user-tag { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; }
        .owner-tag { background: var(--owner-bg); color: white; animation: glow 2s infinite alternate; }
        .member-tag { background: var(--member-bg); color: white; }
        @keyframes glow { from { box-shadow: 0 0 5px #ef4444; } to { box-shadow: 0 0 15px #ef4444, 0 0 20px #f97316; } }
        .profile-bio { font-size: 1.1rem; opacity: 0.9; margin-bottom: 20px; }
        .profile-stats { display: flex; gap: 30px; margin-bottom: 20px; }
        .stat-value { font-size: 1.8rem; font-weight: 800; color: white; display: block; }
        .stat-label { font-size: 0.9rem; opacity: 0.8; text-transform: uppercase; }
        .profile-actions { display: flex; gap: 15px; flex-wrap: wrap; }
        .profile-btn { padding: 12px 24px; border: 2px solid white; background: rgba(255,255,255,0.2); color: white; border-radius: 25px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .profile-details { padding: 30px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .info-item { background: #f1f5f9; padding: 20px; border-radius: 12px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 16px; width: 90%; max-width: 500px; }
        .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Home</a>
            <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
            <h1>My Profile</h1>
            <p>Manage your profile and view your AI prompt creations</p>
        </div>

        <div class="profile-container">
            <div class="profile-header">
                <div class="profile-content">
                    <div style="position: relative;">
                        <img src="https://ui-avatars.com/api/?name=User&background=random" alt="Profile" class="profile-avatar" id="profileAvatar">
                        <button class="edit-avatar-btn" id="editAvatarBtn"><i class="fas fa-camera"></i></button>
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <h2 class="profile-name" id="profileName">User Name</h2>
                            <div class="user-tag member-tag" id="userTag">Member</div>
                        </div>
                        <p class="profile-bio" id="profileBio">This is my bio. I love creating AI art prompts!</p>
                        <div class="profile-stats">
                            <div class="stat"><span class="stat-value" id="promptsCount">0</span><span class="stat-label">Prompts</span></div>
                            <div class="stat"><span class="stat-value" id="followersCount">0</span><span class="stat-label">Followers</span></div>
                            <div class="stat"><span class="stat-value" id="followingCount">0</span><span class="stat-label">Following</span></div>
                            <div class="stat"><span class="stat-value" id="likesCount">0</span><span class="stat-label">Likes</span></div>
                        </div>
                        <div class="profile-actions">
                            <button class="profile-btn" id="editProfileBtn"><i class="fas fa-edit"></i> Edit Profile</button>
                            <button class="profile-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="profile-details">
                <div class="info-grid">
                    <div class="info-item"><div style="font-size: 0.9rem; color: #64748b; margin-bottom: 5px;">Email Address</div><div style="font-size: 1.1rem; font-weight: 600;" id="userEmail">user@example.com</div></div>
                    <div class="info-item"><div style="font-size: 0.9rem; color: #64748b; margin-bottom: 5px;">Member Since</div><div style="font-size: 1.1rem; font-weight: 600;" id="joinDate">January 2024</div></div>
                    <div class="info-item"><div style="font-size: 0.9rem; color: #64748b; margin-bottom: 5px;">Account Status</div><div style="font-size: 1.1rem; font-weight: 600;" id="accountStatus">Active</div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <h2 style="margin-bottom: 20px;">Edit Profile</h2>
            <form id="editProfileForm">
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <img src="https://ui-avatars.com/api/?name=User&background=random" alt="Profile" class="profile-avatar" id="editProfileAvatar" style="width: 80px; height: 80px;">
                        <div style="flex: 1;">
                            <input type="file" id="editProfileImage" accept="image/*" style="display: none;">
                            <label for="editProfileImage" style="display: block; padding: 12px 15px; border: 2px dashed #e2e8f0; border-radius: 12px; background: #f8fafc; color: #64748b; text-align: center; cursor: pointer;"><i class="fas fa-camera"></i> Change Photo</label>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">Full Name</label>
                    <input type="text" id="editProfileName" placeholder="Enter your full name" style="width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem;" required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">Bio</label>
                    <textarea id="editProfileBio" placeholder="Tell us about yourself..." rows="3" style="width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; resize: vertical;"></textarea>
                </div>
                <button type="submit" style="background: var(--gradient); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: 600; width: 100%;"><i class="fas fa-save"></i> Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDovL4QBUZfueYzMJpkCjWu_4NLMoQWyiA",
            authDomain: "gagsta-paradise.firebaseapp.com",
            projectId: "gagsta-paradise",
            storageBucket: "gagsta-paradise.firebasestorage.app",
            messagingSenderId: "78516691257",
            appId: "1:78516691257:web:466954e941fc6a7eb388e8"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const OWNER_EMAIL = "alizybaby381@gmail.com";

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            const icon = document.getElementById('themeToggle').querySelector('i');
            icon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }
        document.getElementById('themeToggle').addEventListener('click', () => {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            const icon = document.getElementById('themeToggle').querySelector('i');
            icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        });

        // Auth Check
        auth.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                loadUserData(user.uid);
            }
        });

        async function loadUserData(uid) {
            const userDoc = await db.collection('users').doc(uid).get();
            const userData = userDoc.exists ? userDoc.data() : {
                name: auth.currentUser.displayName || 'User',
                email: auth.currentUser.email,
                avatar: auth.currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(auth.currentUser.displayName || 'User')}&background=random`,
                bio: "This is my bio. I love creating AI art prompts!",
                prompts: 0, followers: 0, following: 0, likes: 0,
                createdAt: new Date()
            };

            document.getElementById('profileName').textContent = userData.name;
            document.getElementById('profileBio').textContent = userData.bio;
            document.getElementById('profileAvatar').src = userData.avatar;
            document.getElementById('userEmail').textContent = auth.currentUser.email;
            document.getElementById('promptsCount').textContent = userData.prompts || 0;
            document.getElementById('followersCount').textContent = userData.followers || 0;
            document.getElementById('followingCount').textContent = userData.following || 0;
            document.getElementById('likesCount').textContent = userData.likes || 0;
            document.getElementById('joinDate').textContent = userData.createdAt ? userData.createdAt.toDate().toLocaleDateString('en-US', { year: 'numeric', month: 'long' }) : 'January 2024';

            const userTag = document.getElementById('userTag');
            if (auth.currentUser.email === OWNER_EMAIL) {
                userTag.textContent = 'Site Owner';
                userTag.className = 'user-tag owner-tag';
            } else {
                userTag.textContent = 'Member';
                userTag.className = 'user-tag member-tag';
            }
        }

        // Edit Profile
        document.getElementById('editProfileBtn').addEventListener('click', () => {
            document.getElementById('editProfileName').value = document.getElementById('profileName').textContent;
            document.getElementById('editProfileBio').value = document.getElementById('profileBio').textContent;
            document.getElementById('editProfileAvatar').src = document.getElementById('profileAvatar').src;
            document.getElementById('editProfileModal').style.display = 'block';
        });

        document.getElementById('editProfileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('editProfileName').value;
            const bio = document.getElementById('editProfileBio').value;
            const imageFile = document.getElementById('editProfileImage').files[0];

            try {
                let avatarUrl = document.getElementById('profileAvatar').src;
                if (imageFile) {
                    const storageRef = storage.ref();
                    const imageRef = storageRef.child(`profiles/${auth.currentUser.uid}_${Date.now()}`);
                    const snapshot = await imageRef.put(imageFile);
                    avatarUrl = await snapshot.ref.getDownloadURL();
                }

                await auth.currentUser.updateProfile({ displayName: name, photoURL: avatarUrl });
                await db.collection('users').doc(auth.currentUser.uid).update({ name, bio, avatar: avatarUrl });

                document.getElementById('profileName').textContent = name;
                document.getElementById('profileBio').textContent = bio;
                document.getElementById('profileAvatar').src = avatarUrl;
                document.getElementById('editProfileAvatar').src = avatarUrl;
                document.getElementById('editProfileModal').style.display = 'none';
                showNotification('Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error updating profile', 'error');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut();
            window.location.href = 'index.html';
        });

        // Modal Management
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.target.closest('.modal').style.display = 'none';
            });
        });
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i><span>${message}</span>`;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }

        document.addEventListener('DOMContentLoaded', initTheme);
    </script>
</body>
</html>
